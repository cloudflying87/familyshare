{% extends "admin/base_site.html" %}

{% block content %}
<div style="max-width: 800px; margin: 40px auto; padding: 20px;">
    <h1>{{ title }}</h1>

    <div style="background: #e8f4f8; border-left: 4px solid #0066cc; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <h3 style="margin-top: 0;">üöó How to Use</h3>
        <ol style="margin: 10px 0;">
            <li>Browse to a car listing on any dealer website</li>
            <li>Copy the full URL from your browser's address bar</li>
            <li>Paste it in the form below</li>
            <li>Click "Fetch and Parse" - the system will extract car details</li>
            <li>Review the extracted data and make any corrections</li>
            <li>Click "Save Car" to add it to your list</li>
        </ol>
    </div>

    <div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <h3 style="margin-top: 0;">‚ú® What Gets Auto-Filled</h3>
        <ul style="margin: 10px 0;">
            <li><strong>Basic Info:</strong> Make, Model, Year, Trim</li>
            <li><strong>Details:</strong> VIN, Stock #, Price, Mileage</li>
            <li><strong>Specs:</strong> MPG (City/Highway), Ground Clearance</li>
            <li><strong>Smart Ratings:</strong> Winter & Reliability ratings based on your comparison data</li>
            <li><strong>Dealer:</strong> Auto-detected from URL</li>
        </ul>
    </div>

    <!-- Method 1: Auto-fetch URL -->
    <form method="post" style="background: white; border: 1px solid #ddd; padding: 20px; border-radius: 4px; margin-bottom: 20px;">
        {% csrf_token %}
        <h3 style="margin-top: 0;">Method 1: Auto-Fetch from URL</h3>

        <div style="margin-bottom: 20px;">
            <label for="url" style="display: block; font-weight: bold; margin-bottom: 10px; font-size: 16px;">
                üìã Paste Car Listing URL:
            </label>
            <input type="url" name="url" id="url" required
                   placeholder="https://example.com/inventory/used-2015-subaru-outback..."
                   style="padding: 12px; border: 2px solid #ddd; border-radius: 4px; width: 100%; font-size: 14px; box-sizing: border-box;">
            <small style="display: block; margin-top: 5px; color: #666;">
                Try this first - works with most dealer websites
            </small>
        </div>

        <div style="margin-top: 20px;">
            <button type="submit"
                    style="background: #417690; color: white; padding: 14px 28px; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer;">
                üîç Fetch and Parse Car Data
            </button>
        </div>
    </form>

    <!-- Method 2: Paste HTML -->
    <details style="background: white; border: 1px solid #ddd; padding: 20px; border-radius: 4px;">
        <summary style="cursor: pointer; font-weight: bold; font-size: 16px; margin-bottom: 15px;">
            Method 2: Paste HTML (if auto-fetch is blocked)
        </summary>

        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin: 15px 0; border-radius: 4px;">
            <strong>Use this if the website blocks automated requests:</strong>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li>Open the car listing in your browser</li>
                <li>Right-click ‚Üí "View Page Source" (or press Ctrl+U / Cmd+Option+U)</li>
                <li>Copy all the HTML (Ctrl+A, Ctrl+C / Cmd+A, Cmd+C)</li>
                <li>Paste it in the box below</li>
            </ol>
        </div>

        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="paste_html" value="1">

            <div style="margin-bottom: 15px;">
                <label for="url2" style="display: block; font-weight: bold; margin-bottom: 5px;">
                    URL:
                </label>
                <input type="url" name="url" id="url2" required
                       placeholder="https://example.com/inventory/..."
                       style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; width: 100%; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 15px;">
                <label for="html_content" style="display: block; font-weight: bold; margin-bottom: 5px;">
                    Paste HTML Source Code:
                </label>
                <textarea name="html_content" id="html_content" rows="10" required
                          placeholder="Paste the full HTML source code here..."
                          style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; width: 100%; font-family: monospace; font-size: 12px; box-sizing: border-box;"></textarea>
            </div>

            <button type="submit"
                    style="background: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 4px; font-size: 14px; font-weight: bold; cursor: pointer;">
                üìù Parse HTML and Extract Data
            </button>
        </form>
    </details>

    <!-- Method 3: Quick Text Paste (iPhone Friendly) -->
    <details style="background: white; border: 1px solid #ddd; padding: 20px; border-radius: 4px; margin-top: 20px;">
        <summary style="cursor: pointer; font-weight: bold; font-size: 16px; margin-bottom: 15px; color: #28a745;">
            üì± Method 3: Quick Text Paste (iPhone/Mobile Friendly)
        </summary>

        <div style="background: #d4edda; border-left: 4px solid #28a745; padding: 10px; margin: 15px 0; border-radius: 4px;">
            <strong>Easy method for mobile:</strong>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li>Open the car listing on your phone</li>
                <li>Select and copy ALL the text on the page (long-press ‚Üí Select All ‚Üí Copy)</li>
                <li>Paste it in the box below along with the URL</li>
                <li>The parser will find VIN, price, mileage, etc. from the text</li>
            </ol>
        </div>

        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="paste_html" value="1">

            <div style="margin-bottom: 15px;">
                <label for="url3" style="display: block; font-weight: bold; margin-bottom: 5px; font-size: 16px;">
                    üîó URL:
                </label>
                <input type="url" name="url" id="url3" required
                       placeholder="https://www.bloomingtonsubaru.com/inventory/..."
                       style="padding: 14px; border: 2px solid #28a745; border-radius: 6px; width: 100%; font-size: 16px; box-sizing: border-box;">
            </div>

            <div style="margin-bottom: 15px;">
                <label for="html_content3" style="display: block; font-weight: bold; margin-bottom: 5px; font-size: 16px;">
                    üìù Paste ALL Text from Page:
                </label>
                <textarea name="html_content" id="html_content3" rows="12" required
                          placeholder="Long-press here ‚Üí Paste all the text you copied from the car listing page..."
                          style="padding: 14px; border: 2px solid #28a745; border-radius: 6px; width: 100%; font-size: 16px; box-sizing: border-box;"></textarea>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Just paste the text - no need for HTML source code! The parser will find VIN, price, mileage, etc.
                </small>
            </div>

            <button type="submit"
                    style="background: #28a745; color: white; padding: 16px 32px; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%;">
                ‚ú® Extract Car Data
            </button>
        </form>
    </details>

    <div style="margin-top: 20px;">
        <a href="{% url 'admin:core_car_changelist' %}"
           style="padding: 14px 28px; background: #f5f5f5; color: #333; text-decoration: none; border-radius: 4px; display: inline-block; font-size: 16px;">
            Cancel
        </a>
    </div>

    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; border-radius: 4px;">
        <h4 style="margin-top: 0;">üí° Tips</h4>
        <ul style="margin: 10px 0;">
            <li><strong>Mobile-Friendly:</strong> This works great on your phone! Copy the URL and paste it here.</li>
            <li><strong>Any Dealer:</strong> Works with most dealer websites - not just Bloomington Subaru</li>
            <li><strong>Review First:</strong> Always review extracted data before saving</li>
            <li><strong>Auto-Ratings:</strong> Subaru Outback/Forester 2015-2018 get automatic "good" ratings</li>
        </ul>
    </div>
</div>

<style>
    /* Mobile-friendly styles */
    @media (max-width: 768px) {
        div[style*="max-width: 800px"] {
            padding: 10px !important;
        }
        input[type="url"] {
            font-size: 16px !important; /* Prevents zoom on iOS */
        }
        button, a {
            display: block !important;
            width: 100% !important;
            margin: 10px 0 !important;
            text-align: center !important;
        }
    }
</style>
{% endblock %}
